<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Philip: insert-album</title>

	<!--  Style grabbed and modified from firebase hosting template -->
	<style media="screen">
		body { background: #ECEFF1; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
		#box { background: white; max-width: 1080px; margin: 16px auto 16px; padding: 32px 24px; border-radius: 3px; }
		#box h2 { color: #ffa100; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
		#box h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px;}
		#box a { color: black; }
		#box p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
		/*#box a { display: block; text-align: center; background: #039be5; text-transform: uppercase; text-decoration: none; color: white; margin: 16px 350px; padding: 16px; border-radius: 4px; }*/
		#box, /*#box a*/ { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
		#footer { color: rgba(0,0,0,0.4); text-align: center; font-size: 13px; }
		#small { color: rgba(0,0,0,0.4); font-size: 13px; }
		@media (max-width: 600px) {
		body, #box { margin-top: 0; background: white; box-shadow: none; }
		body { border-top: 16px solid #ffa100; }
		}
	</style>
	</head>
	<body>
	<div id="box">
		<h2>insert-album</h2>
		<h1><a href="#/home">Album viewer</a></h1>
		<p>Here are some albums</p>
	</div>

	<div id="flow">

	</div>

	<div id="footer">
		<p>Made by <a href="//philipnord.se">Philip</a> for <a href="//insertcoin.se">Insert Coin</a></p>
	</div>
	<script>
		document.addEventListener("DOMContentLoaded", function(event) {
			locationHashChanged();
		});

		function queryAlbums(){
			const http = new XMLHttpRequest();
			http.open("GET", "https://insert-album.appspot.com/albums/");
			http.send();

			http.onload = () => {
				const albumList = JSON.parse(http.responseText);
				albumList.forEach(element => {
					makeAlbum(element.title,element.id, 7);
				});
			}
		}

		function queryAlbum(id){
			const http = new XMLHttpRequest();
			http.open("GET", "https://insert-album.appspot.com/albums/" + id);
			http.send();
			http.onload = () => {
				const album = JSON.parse(http.responseText);
				makeAlbum(album.title,album.id, -1);
			}
		}

		function queryThumbnails(albumId, grid, n){
			const http = new XMLHttpRequest();
			http.open("GET", "https://insert-album.appspot.com/albums/" + albumId + "/photos/");
			http.send();
			http.onload = () => {
				var photoList = JSON.parse(http.responseText);
				photoList.forEach(function(photo, i){
					if(i < n || n == -1){
						var thumb = document.createElement("img");
						thumb.src = photo.thumbnailUrl;
						grid.appendChild(thumb);
					}
				});
			}
		}

		function makeAlbum(title, id, size){
			const flow = document.getElementById("flow");

			var newDiv = document.createElement("div");
			newDiv.id = "box";
			var title = document.createTextNode(title);
			var albumLink = document.createElement("a");
			albumLink.href = "#/album/" + id;
			albumLink = document.createElement("h1").appendChild(albumLink);
			albumLink.appendChild(title);
			newDiv.appendChild(albumLink);
			newDiv.appendChild(document.createElement("br"));
			var albumId = document.createElement("p");
			albumId.id = "small";
			albumId.appendChild(document.createTextNode("id: " + id));
			newDiv.appendChild(albumId);

			var thumbnailGrid = document.createElement("div");
			thumbnailGrid.id = "thumbnails-" + id;
			queryThumbnails(id, thumbnailGrid, size);
			newDiv.appendChild(thumbnailGrid);
			flow.appendChild(newDiv);
		};

		function showAlbum(id){
			console.log("id " + id);
			flushFlow();
			queryAlbum(id);
		}

		function highightPhoto(id){
			console.log("photoid " + id);
		}

		function flushFlow(){
			const flow = document.getElementById("flow");
			while(flow.firstChild){
				flow.removeChild(flow.firstChild);
			}
		}

		function locationHashChanged() {
			if(/#\/album\/[0-9]+/.test(location.hash)){
				showAlbum(location.hash.substring(8));
			} else if(/#\/photo\/[0-9]+/.test(location.hash)){
				highlightPhoto(location.hash.substring(8));
			} else {
				flushFlow();
				queryAlbums();
			}
		}

		window.onhashchange = locationHashChanged;
	</script>
	</body>
</html>
